/* Basic Element Properties Plugin for TinyMCE */
tinymce.PluginManager.add('element', function (editor) {
    var config = {}
    var dialogConfig =  function(element){
        return {
            title: 'Element Properties ('+element.tagName+')',
            body: {
                type: 'panel',
                items: [
                    {
                        type: 'input',
                        name: 'id',
                        label: 'ID'
                    },
                    {
                        type: 'input',
                        name: 'classname',
                        label: 'Class Name'
                    },
                    {
                        type: 'colorinput',
                        name: 'color',
                        label: 'Text Color'
                    },
                    {
                        type: 'colorinput',
                        name: 'backgroundColor',
                        label: 'Background Color'
                    },
                    {
                        type: 'input',
                        name: 'backgroundImage',
                        label: 'Image'
                    }
                ]
            },
            buttons: [
                {
                    type: 'cancel',
                    name: 'closeButton',
                    text: 'Cancel'
                },
                {
                    type: 'submit',
                    name: 'submitButton',
                    text: 'Update',
                    primary: true
                }
            ],
            initialData: {
                classname: element.className,
                id: element.id,
                backgroundColor: element.style.backgroundColor,
                color: element.style.color,
                backgroundImage: element.style.backgroundImage,
            },
            onSubmit: function (api) {
                var data = api.getData();
                console.log(data)
                element.setAttribute('class', data.classname)
                element.setAttribute('id', data.id)
                tinymce.activeEditor.dom.setStyle(element, 'background-color', data.backgroundColor )
                tinymce.activeEditor.dom.setStyle(element, 'color', data.color )
                tinymce.activeEditor.dom.setStyle(element, 'background-image', data.backgroundImage )
                //tinymce.activeEditor.execCommand('mceInsertContent', false, '<p>My ' + pet +'\'s name is: <strong>' + data.catdata + '</strong></p>');
                api.close();
            }
        }
    };
    editor.ui.registry.addMenuItem('element', {
        icon: 'image',
        text: 'Element properties',
        onAction: function (e) {
            config.event = e
            console.log('context menu clicked',config);
            editor.windowManager.open(dialogConfig(config.currentElement))
        }
    });
    editor.ui.registry.addContextMenu('element', {
        update: function (element) {
            console.log('update', element);
            config.currentElement = element
            return 'element';
        }
    });
});
